<?php

namespace App\Http\Controllers;

use App\Models\Asistencia;
use Illuminate\Http\Request;
use Carbon\Carbon;

class AsistenciaController extends Controller
{
    /**
     * Obtiene las asistencias del dÃ­a actual
     */
    public function getAsistenciasDiarias()
    {
        $asistencias = Asistencia::with(['usuario' => function($query) {
                $query->select('id', 'nombres_completos', 'documento_identidad', 'profile_photo');
            }, 'jornada' => function($query) {
                $query->select('id', 'nombre', 'hora_entrada', 'tolerancia');
            }, 'registro' => function($query) {
                $query->select('id', 'nombre_programa');
            }])
            ->whereDate('fecha_hora', Carbon::today())
            ->orderBy('created_at', 'desc')
            ->get();
        
        return response()->json([
            'status' => 'success',
            'data' => $asistencias,
            'count' => $asistencias->count(),
            'timestamp' => now()
        ]);
    }

    /**
     * Obtiene las asistencias de un usuario especÃ­fico
     */
    public function getAsistenciasByUsuario($id)
    {
        $asistencias = Asistencia::with(['jornada', 'registro'])
            ->where('user_id', $id)
            ->orderBy('fecha_hora', 'desc')
            ->get();
        
        return response()->json([
            'status' => 'success',
            'data' => $asistencias
        ]);
    }
}